---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import { getAllPosts } from '../lib/notion';
import BlogLayout from '../components/BlogLayout.jsx';

const posts = await getAllPosts();
---

<Layout title="Notion CMS Prototype">
  <main>
    <section>
      <h1>This is a Prototype Powered by Notion</h1>
      <!-- Use client:load for hydration while preserving SSR -->
      <BlogLayout client:load initialPosts={posts} />
      
      <noscript>
        <section class="posts">
          {posts.map(post => (
            <article class="post-card">
              {post.featuredImage && (
                <div class="post-image">
                  <a href={`/posts/${post.slug}`}>
                    <img src={post.featuredImage} alt={post.title} />
                  </a>
                </div>
              )}
              
              <div class="post-content">
                <h2><a href={`/posts/${post.slug}`}>{post.title}</a></h2>
                {post.description && <p class="post-description">{post.description}</p>}
                <div class="post-meta">
                  <time datetime={post.publishedDate}>
                    {new Date(post.publishedDate).toLocaleDateString('en-US')}
                  </time>
                  <div class="tags">
                    {post.tags.map(tag => (
                      <span class="tag">{tag}</span>
                    ))}
                  </div>
                </div>
              </div>
            </article>
          ))}
        </section>
      </noscript>
    </div>
    </section>
  </main>
</Layout>